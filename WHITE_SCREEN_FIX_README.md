# حل مشكلة الشاشة البيضاء بعد التحديثات

## المشكلة
بعد بعض التحديثات، عند تشغيل التطبيق تظهر شاشة التحميل ثم شاشة بيضاء بدلاً من شاشة تسجيل الدخول.

## السبب
المشكلة تحدث لأن التطبيق يعمل في وضع Demo Mode بسبب عدم إعداد Supabase بشكل صحيح.

## الحلول المطبقة

### 1. إضافة AuthGuard
تم إنشاء مكون `AuthGuard` للتحكم في التوجيه التلقائي:
- يتحقق من حالة المستخدم
- يوجه المستخدمين غير المسجلين إلى شاشة تسجيل الدخول
- يوجه المستخدمين المسجلين إلى التطبيق الرئيسي

### 2. تحسين منطق التوجيه
- إزالة منطق التوجيه المكرر من ملفات أخرى
- تحسين التعامل مع حالات التحميل
- منع حدوث حلقة توجيه

### 3. إعداد Supabase
يجب إعداد Supabase لحل المشكلة نهائياً:

#### الخطوات:
1. **إنشاء مشروع Supabase**
   - اذهب إلى [supabase.com](https://supabase.com)
   - أنشئ مشروع جديد

2. **الحصول على بيانات الاتصال**
   - في لوحة التحكم: Settings > API
   - انسخ Project URL و anon key

3. **إنشاء ملف .env**
   ```env
   EXPO_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
   EXPO_PUBLIC_SUPABASE_ANON_KEY=your_anon_key_here
   ```

4. **إعادة تشغيل التطبيق**
   ```bash
   npx expo start --clear
   ```

## التحسينات المضافة

### AuthGuard الجديد
```typescript
// يتحقق من حالة المستخدم ويوجه تلقائياً
- إذا لم يكن هناك مستخدم → يوجه إلى تسجيل الدخول
- إذا كان المستخدم مسجل → يوجه إلى التطبيق
- يمنع حلقة التوجيه
```

### تحسينات في AuthContext
- تحسين التعامل مع حالات التحميل
- إضافة رسائل console للتتبع
- تحسين التعامل مع الأخطاء

## كيفية الاختبار

### 1. بدون Supabase (Demo Mode)
- سيعمل التطبيق في وضع Demo
- ستظهر رسائل تحذير في console
- لن تعمل وظائف تسجيل الدخول

### 2. مع Supabase مُعد
- ستظهر شاشة تسجيل الدخول
- يمكن إنشاء حساب جديد
- يمكن تسجيل الدخول

## استكشاف الأخطاء

### إذا استمرت الشاشة البيضاء:
1. تحقق من console logs
2. تأكد من وجود ملف `.env`
3. تأكد من صحة بيانات Supabase
4. أعد تشغيل التطبيق بـ `--clear`

### رسائل Console المتوقعة:
```
[AuthContext] Demo Mode: Supabase not configured
[AuthGuard] No user found, redirecting to sign-in...
```

## ملاحظات مهمة
- تأكد من أن ملف `.env` في المجلد الرئيسي
- لا تشارك مفاتيح Supabase
- في الإنتاج، استخدم متغيرات بيئة آمنة
- تحقق من إعدادات RLS في Supabase

## الملفات المحدثة
- `components/AuthGuard.tsx` (جديد)
- `app/_layout.tsx` (محدث)
- `app/(tabs)/profile.tsx` (محدث)
- `SUPABASE_SETUP_GUIDE.md` (جديد) 